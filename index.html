<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙƒØ´Ù Ø£Ø¬Ù‡Ø²Ø© Ø´Ø±ÙƒØ© Ø§Ù„Ù</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
}

body{
  font-family: Tahoma, Arial;
  background:#f4f6f8;
  margin:0;
  padding:15px;
}

.container{
  background:#fff;
  padding:25px;
  max-width:1300px;
  margin:auto;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

/* ===== Header ===== */
.header{
  text-align:center;
}
.header img{
  width:110px;
  height:110px;
  border-radius:50%;
  border:3px solid #0d6efd;
}
.company{
  color:#0d6efd;
  font-weight:bold;
  margin-top:10px;
}
h2{
  margin:15px 0;
}

/* ===== Counter ===== */
.counter{
  background:#eef3ff;
  padding:10px 25px;
  border-radius:14px;
  font-weight:bold;
  width:fit-content;
  margin:15px auto;
}

/* ===== Search ===== */
.search{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:15px;
}
.search input{
  flex:1;
  min-width:200px;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
}
.search button{
  padding:12px 20px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}
.search .search-btn{
  background:#0d6efd;
  color:#fff;
}
.search .clear-btn{
  background:#6c757d;
  color:#fff;
}

/* ===== Filters ===== */
.filters{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  margin-bottom:20px;
}
.filters button{
  padding:7px 16px;
  border-radius:20px;
  border:1px solid #0d6efd;
  background:#fff;
  color:#0d6efd;
  cursor:pointer;
  white-space:nowrap;
}
.filters button.active,
.filters button:hover{
  background:#0d6efd;
  color:#fff;
}

/* ===== Cards ===== */
.card{
  display:flex;
  gap:25px;
  padding:20px;
  margin-top:20px;
  border-radius:16px;
  border:3px solid;
  background:#fafafa;
}
.card.ok{border-color:#28a745}
.card.late{border-color:#dc3545}

.card-content{
  flex:2;
  line-height:2;
}

.card-image{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card-image img{
  max-width:100%;
  max-height:260px;
  border-radius:14px;
}

/* ===== Status ===== */
.status.ok{color:#28a745;font-weight:bold}
.status.late{color:#dc3545;font-weight:bold}

/* ===== No Results ===== */
.no-results{
  text-align:center;
  color:#dc3545;
  font-size:18px;
  margin-top:30px;
}

/* ===== Responsive ===== */
@media (max-width: 768px){
  .card{
    flex-direction:column;
  }
  .card-image img{
    max-height:none;
  }
}

@media (max-width: 480px){
  body{
    padding:10px;
  }
  .container{
    padding:18px;
  }
  h2{
    font-size:20px;
  }
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <img src="./assets/alef.jpg">
    <div class="company">Ø´Ø±ÙƒØ© Ø§Ù„Ù Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…</div>
    <h2>ğŸ“‹ ÙƒØ´Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø±ÙƒØ©</h2>
  </div>

  <div class="counter" id="totalCount">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

  <div class="search">
    <input id="searchInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„)">
    <button class="search-btn" onclick="loadData()">Ø¨Ø­Ø«</button>
    <button class="clear-btn" onclick="clearSearch()">âœ– Ù…Ø³Ø­</button>
  </div>

  <div class="filters">
    <button class="active" onclick="setFilter('',this)">Ø§Ù„ÙƒÙ„</button>
    <button onclick="setFilter('ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…ÙƒØªØ¨ÙŠ',this)">ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…ÙƒØªØ¨ÙŠ</button>
    <button onclick="setFilter('Ù„Ø§Ø¨ØªÙˆØ¨',this)">Ù„Ø§Ø¨ØªÙˆØ¨</button>
    <button onclick="setFilter('Ø·Ø§Ø¨Ø¹Ø§Øª',this)">Ø·Ø§Ø¨Ø¹Ø§Øª</button>
    <button onclick="setFilter('Ù‡ÙˆØ§ØªÙ',this)">Ù‡ÙˆØ§ØªÙ</button>
    <button onclick="setFilter('ÙƒØ§Ù…ÙŠØ±Ø§Øª',this)">ÙƒØ§Ù…ÙŠØ±Ø§Øª</button>
    <button onclick="setFilter('Ø³ÙŠØ§Ø±Ø§Øª',this)">Ø³ÙŠØ§Ø±Ø§Øª</button>
  </div>

  <div id="cards"></div>

</div>

<script>
const SHEET_ID="1rwrsnvKALSUMlmtp_9KOVE03-65niHv2-tBcOGbfmk4";
const SHEET_NAME="ÙƒØ´Ù Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©";
let currentFilter="";

function extractUrl(cell){
  if(!cell) return "";
  if(cell.v && typeof cell.v==="string") return cell.v.trim();
  if(cell.f){
    const m=cell.f.match(/href="([^"]+)"/);
    return m?m[1]:"";
  }
  return "";
}

function parseDate(str){
  if(!str) return null;
  const p=str.split("-");
  if(p.length!==3) return null;
  return new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2]));
}

function setFilter(type,btn){
  currentFilter=type;
  document.querySelectorAll(".filters button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  loadData();
}

function clearSearch(){
  document.getElementById("searchInput").value="";
  currentFilter="";
  document.querySelectorAll(".filters button").forEach(b=>b.classList.remove("active"));
  document.querySelector(".filters button").classList.add("active");
  loadData();
}

window.onload=loadData;

async function loadData(){
  const key=document.getElementById("searchInput").value.trim();
  const box=document.getElementById("cards");
  box.innerHTML="";

  const res=await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}`);
  const json=JSON.parse((await res.text()).substring(47).slice(0,-2));
  const rows=json.table.rows;

  let total=0,shown=0;

  rows.forEach(r=>{
    const deviceNo=r.c[0]?.f ?? r.c[0]?.v ?? "";
    const type=r.c[1]?.v ?? "";
    const name=r.c[2]?.v ?? "";
    const desc=r.c[3]?.v ?? "";
    const place=r.c[4]?.v ?? "";
    const imageUrl=extractUrl(r.c[5]);
    const last=r.c[6]?.f ?? "";
    const next=r.c[7]?.f ?? "";

    if(!deviceNo) return;
    total++;
    if(key && !String(deviceNo).includes(key)) return;
    if(currentFilter && type!==currentFilter) return;

    shown++;

    const today=new Date(); today.setHours(0,0,0,0);
    const late=parseDate(next) && parseDate(next)<today;

    box.innerHTML+=`
      <div class="card ${late?'late':'ok'}">
        <div class="card-content">
          <b>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</b> ${deviceNo}<br>
          <b>Ø§Ù„Ù†ÙˆØ¹:</b> ${type}<br>
          <b>Ø§Ù„Ø§Ø³Ù…:</b> ${name}<br>
          <b>Ø§Ù„ÙˆØµÙ:</b> ${desc}<br>
          <b>Ø§Ù„Ù…ÙƒØ§Ù†:</b> ${place}<br>
          <b>Ø¢Ø®Ø± ÙØ­Øµ:</b> ${last}<br>
          <b>Ø§Ù„ÙØ­Øµ Ø§Ù„Ù‚Ø§Ø¯Ù…:</b> ${next}<br>
          <b>Ø§Ù„Ø­Ø§Ù„Ø©:</b>
          <span class="status ${late?'late':'ok'}">
            ${late?'ğŸ”´ Ù…ØªØ£Ø®Ø±':'ğŸŸ¢ Ø³Ù„ÙŠÙ…'}
          </span>
        </div>
        ${imageUrl?`<div class="card-image"><img src="${imageUrl}"></div>`:""}
      </div>
    `;
  });

  document.getElementById("totalCount").innerText=`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total}`;
  if(shown===0){
    box.innerHTML=`<div class="no-results">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¨Ø­Ø«Ùƒ</div>`;
  }
}
</script>

</body>
</html>
