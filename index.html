<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙƒØ´Ù Ø£Ø¬Ù‡Ø²Ø© Ø´Ø±ÙƒØ© Ø§Ù„Ù</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Tahoma, Arial;
  background:#f4f6f8;
  padding:15px;
}
.box{
  background:#fff;
  padding:30px;
  max-width:1300px;
  margin:auto;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

/* Ø§Ù„Ø´Ø¹Ø§Ø± */
.logo{text-align:center;}
.logo img{
  width:120px;height:120px;
  border-radius:50%;
  border:3px solid #0d6efd;
}
.company-name{
  color:#0d6efd;
  font-weight:bold;
  margin-top:10px;
  font-size:18px;
}
h2{text-align:center;margin:20px 0;font-size:28px;}

/* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
.counters{
  display:flex;
  justify-content:center;
  margin-bottom:20px;
}
.counter{
  background:#eef3ff;
  padding:15px 30px;
  border-radius:14px;
  font-weight:bold;
  font-size:18px;
}

/* Ø§Ù„Ø¨Ø­Ø« */
.search-box{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}
.search-box input{
  flex:1;
  padding:15px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
}
.search-box button{
  padding:15px 30px;
  font-size:18px;
  border-radius:10px;
  background:#0d6efd;
  color:#fff;
  border:none;
  cursor:pointer;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ */
.filters{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:25px;
  justify-content:center;
}
.filters button{
  padding:10px 18px;
  border-radius:20px;
  border:1px solid #0d6efd;
  background:#fff;
  color:#0d6efd;
  cursor:pointer;
}
.filters button:hover{
  background:#0d6efd;
  color:#fff;
}

/* Ø§Ù„ÙƒØ±ÙˆØª */
.card{
  display:flex;
  gap:30px;
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
  background:#fafafa;
  border:3px solid;
}
.ok{border-color:#28a745;}
.late{border-color:#dc3545;}

.card-text{flex:2;line-height:1.9;font-size:16px;}
.card-image{flex:1;}
.card-image img{
  width:100%;
  max-width:320px;
  border-radius:14px;
}

.print-btn{
  margin-top:10px;
  padding:8px 15px;
  background:#444;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.no-results{
  text-align:center;
  font-size:22px;
  color:#dc3545;
  margin-top:30px;
}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media(max-width:768px){
  .card{flex-direction:column;}
  .search-box{flex-direction:column;}
}
</style>
</head>

<body>

<div class="box">

  <div class="logo">
    <img src="./assets/alef.jpg">
    <div class="company-name">Ø´Ø±ÙƒØ© Ø§Ù„Ù Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…</div>
  </div>

  <h2>ğŸ“‹ ÙƒØ´Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø±ÙƒØ©</h2>

  <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯ -->
  <div class="counters">
    <div class="counter" id="countAll">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
  </div>

  <!-- Ø§Ù„Ø¨Ø­Ø« -->
  <div class="search-box">
    <input id="search" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„)">
    <button onclick="load()">Ø¨Ø­Ø«</button>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø­Ø« -->
  <div class="filters">
    <button onclick="setType('')">Ø§Ù„ÙƒÙ„</button>
    <button onclick="setType('ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…ÙƒØªØ¨ÙŠ')">ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…ÙƒØªØ¨ÙŠ</button>
    <button onclick="setType('Ù„Ø§Ø¨ØªÙˆØ¨')">Ù„Ø§Ø¨ØªÙˆØ¨</button>
    <button onclick="setType('Ø·Ø§Ø¨Ø¹Ø©')">Ø·Ø§Ø¨Ø¹Ø§Øª</button>
    <button onclick="setType('Ù‡Ø§ØªÙ Ø£Ø±Ø¶ÙŠ')">Ù‡Ø§ØªÙ Ø£Ø±Ø¶ÙŠ</button>
    <button onclick="setType('Ù…ÙˆØ¨Ø§ÙŠÙ„')">Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
    <button onclick="setType('ÙƒØ§Ù…ÙŠØ±Ø§')">ÙƒØ§Ù…ÙŠØ±Ø§Øª</button>
    <button onclick="setType('Ø³ÙŠØ§Ø±Ø©')">Ø³ÙŠØ§Ø±Ø§Øª</button>
    <button onclick="setType('Ù…ÙƒÙŠÙ')">Ù…ÙƒÙŠÙØ§Øª</button>
    <button onclick="setType('Ø³Ø§Ø¹Ø©')">Ø³Ø§Ø¹Ø§Øª</button>
    <button onclick="setType('Ø«Ù„Ø§Ø¬Ø©')">Ø«Ù„Ø§Ø¬Ø§Øª</button>
    <button onclick="setType('Ø§Ù†ØªØ±Ù†Øª')">Ø§Ù†ØªØ±Ù†Øª</button>
  </div>

  <div id="result"></div>

</div>

<script>
const SHEET_ID = "1rwrsnvKALSUMlmtp_9KOVE03-65niHv2-tBcOGbfmk4";
const SHEET_NAME = "ÙƒØ´Ù Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©";
let currentType = "";

function setType(t){ currentType=t; load(); }
window.onload = load;

async function load(){
  const key = search.value.trim();
  const box = document.getElementById("result");
  box.innerHTML = "";

  let total = 0;
  let shown = 0;

  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}`;
  const res = await fetch(url);
  const json = JSON.parse((await res.text()).substring(47).slice(0,-2));
  const rows = json.table.rows;

  rows.forEach((r,i)=>{
    const no = r.c[0]?.v ?? "";
    const type = r.c[1]?.v ?? "";
    const nextCheck = r.c[7]?.f ?? "";

    total++;

    if(key && !no.includes(key)) return;
    if(currentType && type !== currentType) return;

    shown++;

    const today = new Date();
    const checkDate = nextCheck ? new Date(nextCheck) : null;
    const status = checkDate && checkDate < today ? "late" : "ok";

    box.innerHTML += `
    <div class="card ${status}" id="print-${i}">
      <div class="card-text">
        <b>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</b> ${no}<br>
        <b>Ø§Ù„Ù†ÙˆØ¹:</b> ${type}<br>
        <b>Ø§Ù„Ø§Ø³Ù…:</b> ${r.c[2]?.v ?? ""}<br>
        <b>Ø§Ù„Ù…ÙƒØ§Ù†:</b> ${r.c[4]?.v ?? ""}<br>
        <b>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ Ø§Ù„Ù‚Ø§Ø¯Ù…:</b> ${nextCheck}<br>
        <button class="print-btn" onclick="printCard('print-${i}')">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
      </div>
    </div>`;
  });

  document.getElementById("countAll").innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total}`;

  if(shown === 0){
    box.innerHTML = `<div class="no-results">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¨Ø­Ø«Ùƒ</div>`;
  }
}

function printCard(id){
  const content = document.getElementById(id).innerHTML;
  const w = window.open("", "", "width=900,height=700");
  w.document.write(content);
  w.print();
  w.close();
}
</script>

</body>
</html>
